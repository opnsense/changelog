@ November 26, 2025

Hey,

So we are making way for safer command execution since a comment was
added to the certification of the business version about a possible
injection into interfaces_pfsync_configure() -- note that it was a comment
and not a security issue since the exploit requires to edit the config.xml
and/or do a configuration import.

The issue in interfaces_pfsync_configure() has now been fixed, but as
mentioned the idea was to get rid of these problems once and for all so
the Shell class was rewritten and every call was audited.  You will see
more movement on our way to 26.1 in this area as we do not want to push
all changes into the 25.7 series immediately so that they can be properly
verified first.  Suffice to say most of the code we worked on over the
years was already much safer due to the introduction of exec_safe() very
early in the project history.

The Unbound blocklists feature formerly known as a business feature is
now a community feature!  Since this required merging both the existing
community one with the business one you need to make sure to reapply the
blocklist settings after the reboot since it will not generate a new and
actually incompatible format.  Make sure to check your automatically
migrated settings while at it.

What does all of this mean?  It means security matters.  It also means
that community matters.  We will continue to improve the community version
because it is the base for the business version and that is exactly how
it should be so that everybody can benefit from these changes!

Note this release includes a new kernel with a lot of improvements in the
vtnet(4) driver department.  It is stable code according to release
engineering procedures of FreeBSD but if you are seeing specific issues let
us know.

Here are the full patch notes:

o system: defaults: properly delete empty model containers in the configuration
o system: switch int/bool to string in gateway properties
o system: ignore TypeErrors when parsing log lines in the backend
o system: replace various raw exec(), system(), passthru() and shell_exec() calls with safer variants
o system: add host route deletion support to system_host_route()
o system: move the general page host route removal to system_host_route()
o system: add CA chain to PKCS12 export
o interfaces: support link-local IPv6 mode
o interfaces: also stop PPPoE connections when CARP is temporarily disabled (contributed by Ren√© Mayrhofer)
o interfaces: fix packet capture and ping buttons not working since 25.7.7
o interfaces: limit execution of sysctl scope in PPP device edit code
o interfaces: safer interfaces_pfsync_configure() handling
o firewall: live log: make this grid static and slightly adjust info column width
o firewall: live log: backwards compatibility for old 'interface_name' field type
o firewall: live log: fix wrong variable scope
o firewall: automation: split search logic and normalize legacy output
o firewall: aliases: add a few GeoIP related logging messages
o firewall: mute pfctl-based table entry expire to avoid cron noise due to stderr use
o firewall: aliases: missing placeholder for username in basic auth type selection
o firewall: support "0" as valid rule ID in rule lookup redirect
o firewall: automation: add per-rule state timeouts for "udp.first", "udp.multiple" and "udp.single"
o captive portal: fix selectpicker #voucher-groups not being re-rendered after change event
o captive portal: move grid init to tab show event
o dnsmasq: switch to file_safe() use in backend
o dnsmasq: minor safe execution changes in backend
o kea-dhcp: automatic route support for PD leases
o kea-dhcp: case insensitive MAC address comparison
o isc-dhcp: adjust backend for safe execution
o ipsec: disable model caching on SPD page
o ipsec: add AES256GCM16 to the child ESP proposals list
o ipsec: hide phase 2 output based on phase 1 status instead of the row count for phase 2
o ipsec: add "reqid_base" setting to advanced settings
o openssh: minor safe execution change in backend
o openvpn: swap description and mode in "tls_key" and require a description for static keys
o openvpn: one safe execution change
o openvpn: add fast-io option (contributed by mdten)
o radvd: safe execution changes
o unbound: improve CNAME handling of whitelisted domains
o unbound: safe command execution changes
o unbound: merge extended blocklists into community version
o unbound: duplicate pointer records due to not casting the field types
o wireguard: fix wrong maximum value for "PersistentKeepalive"
o backend: rename "realif" variables to "device" in a number of spots
o backend: avoid the use of get_real_interface() when it does not matter and remove dead code associated with that
o backend: exend shell_safe() to emulate exec() $output argument magic
o backend: reimplement existing command execution functions with Shell class implementation
o backend: replace mwexecf_bg() with mwexecfb() for clarity
o mvc: move translation to menu system and add "FixedName" property
o mvc: extend ModelRelationField so it can optionally disable caching
o mvc: rewrite the old Shell class according to our current standards for safe command execution (exec_safe() wrapper)
o mvc: make "data_change_message_content" configurable
o shell: assorted cleanups in console menu related scripts
o ui: fix tokenizer event trigger loop
o plugins: os-freeradius 1.9.28[1]
o plugins: os-frr 1.49[2]
o plugins: os-ndp-proxy-go 1.0 is a hot-off-the-press userspace IPv6 Neighbor Discovery Proxy[3]
o plugins: os-q-feeds-connector 1.3[4]
o plugins: os-theme-flexcolor 1.0 is a new 3-in one theme[5] (contributed by Schnuffel2008)
o src: vtnet: assorted stable branch improvements
o src: ifconfig: assorted stable branch improvements
o src: SO_REUSEPORT_LB breaks connect(2) for UDP sockets[6]
o src: sctp, tcp, udp: improve deferred computation of checksums
o src: dhclient: improve UDP checksum handling
o src: ipfw: check for errors from sooptcopyin() and sooptcopyout()
o src: ipfw: pmod: avoid further rule processing after tcp-mod failures
o src: dummynet: move excessive logging messages under debug output
o src: net: validate interface group names in ioctl handlers
o src: pf: improve DIOCRCLRTABLES validation
o src: pf: improve add state validation
o src: pf: SCTP abort messages fully close the connection
o src: if_vxlan: fix byteorder of source port
o src: ixl: fix multicast promiscuous mode state tracking and filter management
o src: ix/ixv: add support for new Intel Ethernet E610 family devices
o src: ice: add PCI IDs for E835 devices
o src: ice: add support for E835-XXV-4 adapter
o src: igb: fix out-of-bounds register access on VFs
o src: netlink: in snl_init_writer() do not overwrite error in case of failure
o ports: curl 8.17.0[7]
o ports: nss 3.118.1[8]
o ports: openvpn 2.6.16[9]
o ports: pcre2 10.47[10]
o ports: php 8.3.28[11]


Stay safe,
Your OPNsense team

--
[1] PLUGINS:25.7/net/freeradius
[2] PLUGINS:25.7/net/frr
[3] DOCS:manual/ndp-proxy-go
[4] PLUGINS:25.7/security/q-feeds-connector
[5] PLUGINS:25.7/misc/theme-flexcolor
[6] FREEBSD:FreeBSD-SA-25:09.netinet
[7] CURL:8.17.0
[8] NSS:3.118.1
[9] OPENVPN26:2.6.16
[10] PCRE2:10.47
[11] PHP8:8.3.28
